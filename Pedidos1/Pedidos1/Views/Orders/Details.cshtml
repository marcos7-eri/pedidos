@model Pedidos1.Models.Order
@using Pedidos1.Models
@{
    ViewData["Title"] = "Detalle Pedido";
}
<h2>Pedido #@Model.Id</h2>
<p><strong>Cliente:</strong> @Model.Customer?.Name</p>
<p><strong>Fecha:</strong> @Model.CreatedAt.ToLocalTime()</p>
<p><strong>Estado:</strong> @Model.Status</p>

<table class="table">
    <thead><tr><th>Producto</th><th>Cantidad</th><th>Precio</th><th>Subtotal</th></tr></thead>
    <tbody>
        @foreach (var i in Model.Items)
        {
            <tr>
                <td>@i.Product?.Name</td>
                <td>@i.Quantity</td>
                <td>@i.Product?.Price.ToString("0.00")</td>
                <td>@i.Subtotal.ToString("0.00")</td>
            </tr>
        }
    </tbody>
    <tfoot>
        <tr><th colspan="3" class="text-end">Total</th><th>@Model.Total.ToString("0.00")</th></tr>
    </tfoot>
</table>

@if (User.IsInRole("admin") || User.IsInRole("empleado"))
{
    <form asp-action="ChangeStatus" method="post" class="mt-3">
        @Html.AntiForgeryToken()
        <input type="hidden" name="id" value="@Model.Id" />
        <div class="input-group" style="max-width:320px">
            <select name="status" class="form-select">
                @foreach (OrderStatus s in Enum.GetValues(typeof(OrderStatus)))
                {
                    <option value="@s" selected="@(s == Model.Status)">@s</option>
                }
            </select>
            <button class="btn btn-outline-primary">Actualizar</button>
        </div>
    </form>
}
